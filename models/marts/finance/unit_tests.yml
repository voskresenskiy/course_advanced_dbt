unit_tests:
  - name: mrr_is_correct
    model: fct_mrr
    given:
      - input: ref('dim_subscriptions')
        format: csv
        rows: |
          subscription_id,user_id,starts_at,ends_at,plan_name,pricing,billing_period
          0,46344,2019-01-02 02:49:50.000,2019-01-06 02:49:50.000,Basic,0.10,monthly
      - input: ref('int_dates')
        format: csv
        rows: |
          calendar_date,day_of_month
          2019-01-01,1
          2019-02-01,1
    expect:
      format: csv
      rows: |
        date_month,user_id,subscription_id,starts_at,ends_at,plan_name,mrr_amount,mrr_change,retained_mrr_amount,previous_month_mrr_amount,change_category,month_retained_number
        2019-01-01,46344,0,2019-01-02 02:49:50.000,2019-01-06 02:49:50.000,Basic,0.10,0.10,0.00,0.00,new,0
        2019-02-01,46344,0,2019-01-02 02:49:50.000,2019-01-06 02:49:50.000,Basic,0.00,-0.10,0.00,0.10,churn,
